## 十分钟入门 pandas 

``` python 
>>> import pandas as pd
>>> import numpy  as np
>>> import matplotlib.pyplot as plt 
```



### 创建对象

Series 是一个值的序列，它只有一个列，以及索引

``` python
# np.nan 相当于 null
>>> s = pd.Series([1,3,5,np.nan,6,8])
>>> s
0    1.0
1    3.0
2    5.0
3    NaN
4    6.0
5    8.0
dtype: float64
```

DataFrame 是有多个列的数据表，每个列拥有一个 label，DataFrame 也有索引

``` python
>>> dates = pd.date_range('20161031',periods=6)
>>> dates
DatetimeIndex(['2016-10-31', '2016-11-01', '2016-11-02', '2016-11-03',
               '2016-11-04', '2016-11-05'],
              dtype='datetime64[ns]', freq='D')
# dates 作为索引
>>> df = pd.DataFrame(np.random.randn(6,4), index=dates, columns=list('ABCD'))
>>> df
                   A         B         C         D
2016-10-31 -0.812604 -0.158759 -0.479093  1.380928
2016-11-01  1.756013 -1.229755 -0.630546  1.751761
2016-11-02 -0.254927  0.345496 -0.877803 -0.202867
2016-11-03  0.788733 -1.080077  0.228994 -0.107704
2016-11-04  0.029082  0.155546  0.875730  1.123133
2016-11-05  0.123455  0.283322  0.813459 -1.526909
>>> 
```

如果参数是一个 dict，每个 dict 的 value 会被转化成一个 Series,注意下 Series 的概念，以及如果没有 D，会报错如下：

>  If using all scalar values, you must pass an index

``` python
>>> df2 = pd.DataFrame({'A':1.,
...                     'B':pd.Timestamp('20161031'),
...                     'C':'foo',
...                      'D':pd.Series(1,index=list(range(4)),dtype='float32')})
>>> df2
     A          B    C    D
0  1.0 2016-10-31  foo  1.0
1  1.0 2016-10-31  foo  1.0
2  1.0 2016-10-31  foo  1.0
3  1.0 2016-10-31  foo  1.0
>>> 

```

如下为部分 DataFrame 恰好就是 Series 的格式，故可以认为 DataFrame 由 Series 组成：

``` python
>>> df2.B
0   2016-10-31
1   2016-10-31
2   2016-10-31
3   2016-10-31
Name: B, dtype: datetime64[ns]
>>> 
```

### 查看数据

查看前几行或者后几行数据：

``` python
>>> df.head(2)
                   A         B         C         D
2016-10-31 -0.812604 -0.158759 -0.479093  1.380928
2016-11-01  1.756013 -1.229755 -0.630546  1.751761
>>> df
                   A         B         C         D
2016-10-31 -0.812604 -0.158759 -0.479093  1.380928
2016-11-01  1.756013 -1.229755 -0.630546  1.751761
2016-11-02 -0.254927  0.345496 -0.877803 -0.202867
2016-11-03  0.788733 -1.080077  0.228994 -0.107704
2016-11-04  0.029082  0.155546  0.875730  1.123133
2016-11-05  0.123455  0.283322  0.813459 -1.526909
>>> df.tail(3)
                   A         B         C         D
2016-11-03  0.788733 -1.080077  0.228994 -0.107704
2016-11-04  0.029082  0.155546  0.875730  1.123133
2016-11-05  0.123455  0.283322  0.813459 -1.526909
>>> 
```

单独查看 index 和 columns,并且发现其 values 形式是 numpy：

``` python
>>> df.index
DatetimeIndex(['2016-10-31', '2016-11-01', '2016-11-02', '2016-11-03',
               '2016-11-04', '2016-11-05'],
              dtype='datetime64[ns]', freq='D')
>>> df.columns
Index([u'A', u'B', u'C', u'D'], dtype='object')
>>> df.values
array([[-0.81260375, -0.15875917, -0.47909347,  1.38092761],
       [ 1.75601295, -1.22975452, -0.63054581,  1.75176104],
       [-0.25492719,  0.34549631, -0.87780348, -0.20286695],
       [ 0.78873276, -1.08007662,  0.2289942 , -0.10770406],
       [ 0.02908234,  0.15554593,  0.87572989,  1.12313327],
       [ 0.12345492,  0.28332176,  0.81345868, -1.52690895]])
>>> 
```

decribe() 用来显示数据的概要，类似于显示最大值，平均值之类的：

``` python
>>> df.describe()
              A         B         C         D
count  6.000000  6.000000  6.000000  6.000000
mean   0.271625 -0.280704 -0.011543  0.403057
std    0.894919  0.700732  0.758672  1.236651
min   -0.812604 -1.229755 -0.877803 -1.526909
25%   -0.183925 -0.849747 -0.592683 -0.179076
50%    0.076269 -0.001607 -0.125050  0.507715
75%    0.622413  0.251378  0.667343  1.316479
max    1.756013  0.345496  0.875730  1.751761
>>> 
```

对 axis 按照 index 排序（`axis=1` 是指第二个维度，即：列）

``` pyth
>>> df.sort_index(axis=1,ascending=False)
                   D         C         B         A
2016-10-31  1.380928 -0.479093 -0.158759 -0.812604
2016-11-01  1.751761 -0.630546 -1.229755  1.756013
2016-11-02 -0.202867 -0.877803  0.345496 -0.254927
2016-11-03 -0.107704  0.228994 -1.080077  0.788733
2016-11-04  1.123133  0.875730  0.155546  0.029082
2016-11-05 -1.526909  0.813459  0.283322  0.123455
>>> df
                   A         B         C         D
2016-10-31 -0.812604 -0.158759 -0.479093  1.380928
2016-11-01  1.756013 -1.229755 -0.630546  1.751761
2016-11-02 -0.254927  0.345496 -0.877803 -0.202867
2016-11-03  0.788733 -1.080077  0.228994 -0.107704
2016-11-04  0.029082  0.155546  0.875730  1.123133
2016-11-05  0.123455  0.283322  0.813459 -1.526909
>>> 

```

> ```python 
> df.sort_values(by='B')  可以用来实现按值排序，比较简单。
> ```

### 获取行/列

获取 A 列：

``` python
>>> df['A']
2016-10-31   -0.812604
2016-11-01    1.756013
2016-11-02   -0.254927
2016-11-03    0.788733
2016-11-04    0.029082
2016-11-05    0.123455
Freq: D, Name: A, dtype: float64
```

获取 1 到 3 行：

``` python
>>> df[0:3]
                   A         B         C         D
2016-10-31 -0.812604 -0.158759 -0.479093  1.380928
2016-11-01  1.756013 -1.229755 -0.630546  1.751761
2016-11-02 -0.254927  0.345496 -0.877803 -0.202867
```

DataFrame 可以通过时间戳的下标（`dates[0] = Timestamp('20161031')`）来访问

``` python
>>> df
                   A         B         C         D
2016-10-31 -0.812604 -0.158759 -0.479093  1.380928
2016-11-01  1.756013 -1.229755 -0.630546  1.751761
2016-11-02 -0.254927  0.345496 -0.877803 -0.202867
2016-11-03  0.788733 -1.080077  0.228994 -0.107704
2016-11-04  0.029082  0.155546  0.875730  1.123133
2016-11-05  0.123455  0.283322  0.813459 -1.526909
# output 20161031 的 ABCD
>>> df.loc[dates[0]]
A   -0.812604
B   -0.158759
C   -0.479093
D    1.380928
Name: 2016-10-31 00:00:00, dtype: float64
```

### 通过正数下标选择

选出第二行：

``` pytho
>>> df.iloc[2]
A   -0.254927
B    0.345496
C   -0.877803
D   -0.202867
Name: 2016-11-02 00:00:00, dtype: float64
```

选出三到四行，零到一列，注意这个数字的取值，不要搞错了：

``` python
>>> df.iloc[3:5,0:2]
                   A         B
2016-11-03  0.788733 -1.080077
2016-11-04  0.029082  0.155546
```

也可以通过 list 选择，下面：

``` python
>>> df.iloc[[1,2,4],[0,2]] 
                   A         C
2016-11-01  1.756013 -0.630546
2016-11-02 -0.254927 -0.877803
2016-11-04  0.029082  0.875730
>>> 
```

也可以通过切片 slice 来选择，同样注意下写法：

``` python
>>> df.iloc[1:3,:]
                   A         B         C         D
2016-11-01  1.756013 -1.229755 -0.630546  1.751761
2016-11-02 -0.254927  0.345496 -0.877803 -0.202867
>>> 
```

布尔值下标：

``` python
>>> df[df.A > 0]
                   A         B         C         D
2016-11-01  1.756013 -1.229755 -0.630546  1.751761
2016-11-03  0.788733 -1.080077  0.228994 -0.107704
2016-11-04  0.029082  0.155546  0.875730  1.123133
2016-11-05  0.123455  0.283322  0.813459 -1.526909
>>>
```

`isin()` 函数：是否在集合中:

``` python
>>> df2 = df.copy()
# 添加 E 列
>>> df2['E'] = ['one','one','two','three','four','three']
>>> df2
                   A         B         C         D      E
2016-10-31 -0.812604 -0.158759 -0.479093  1.380928    one
2016-11-01  1.756013 -1.229755 -0.630546  1.751761    one
2016-11-02 -0.254927  0.345496 -0.877803 -0.202867    two
2016-11-03  0.788733 -1.080077  0.228994 -0.107704  three
2016-11-04  0.029082  0.155546  0.875730  1.123133   four
2016-11-05  0.123455  0.283322  0.813459 -1.526909  three
>>> df2[df2['E'].isin(['two','four'])] 
                   A         B         C         D     E
2016-11-02 -0.254927  0.345496 -0.877803 -0.202867   two
2016-11-04  0.029082  0.155546  0.875730  1.123133  four
>>> 
```

### 统计

求平均值

``` python
>>> df.mean()
A    0.271625
B   -0.280704
C   -0.011543
D    0.403057
dtype: float64
# 对另一个维度求平均值
>>> df.mean(1)
2016-10-31   -0.017382
2016-11-01    0.411868
2016-11-02   -0.247525
2016-11-03   -0.042513
2016-11-04    0.545873
2016-11-05   -0.076668
Freq: D, dtype: float64
```

对行或者列使用 Apply( ) 函数：

``` python
>>> df.apply(np.cumsum)
                   A         B         C         D
2016-10-31 -0.812604 -0.158759 -0.479093  1.380928
2016-11-01  0.943409 -1.388514 -1.109639  3.132689
2016-11-02  0.688482 -1.043017 -1.987443  2.929822
2016-11-03  1.477215 -2.123094 -1.758449  2.822118
2016-11-04  1.506297 -1.967548 -0.882719  3.945251
2016-11-05  1.629752 -1.684226 -0.069260  2.418342
>>> df.apply(lambda x: x.max() - x.min())  
A    2.568617
B    1.575251
C    1.753533
D    3.278670
dtype: float64
>>> 
```

将数据以直方图形式显示：

``` python
>>> s = pd.Series(np.random.randint(0, 7, size=10))
>>> s
0    1
1    5
2    6
3    5
4    2
5    0
6    5
7    1
8    0
9    3
dtype: int64
>>> s.value_counts()
5    3
1    2
0    2
6    1
3    1
2    1
dtype: int64
>>> 
```

字符串处理

``` python
>>> s = pd.Series(['A', 'B', 'C', 'Aaba', 'Baca', np.nan, 'CABA', 'dog', 'cat'])
>>> s
0       A
1       B
2       C
3    Aaba
4    Baca
5     NaN
6    CABA
7     dog
8     cat
dtype: object
>>> s.str.lower()
0       a
1       b
2       c
3    aaba
4    baca
5     NaN
6    caba
7     dog
8     cat
dtype: object
```



